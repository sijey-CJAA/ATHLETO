{% extends "base.html" %}
{% block content %}
<div class="container-fluid p-5 mt-5 mb-3" style="background-color: maroon">
  <h3 class="text-center text-white"><b>ATHLETO ShieldKnee Pro</b></h3>
  <h5 class="text-center text-white">Premium Performance Wear</h5>
</div>

<div class="container">
  <div class="row">
    <div class="col-md-6">
      <img src="{{ url_for('static', filename='pictures/accessories/accessories4.png') }}" class="img-fluid rounded"
        alt="ATHLETO ShieldKnee Pro" style="max-height: 500px;">
    </div>
    <div class="col-md-6">
      <h2>ATHLETO ShieldKnee Pro</h2>
      <h5><i>Full-Length Compression Knee Sleeves</i></h5>
      <p class="lead">₱695 (per pair)</p>
      <p>
        {% if stock > 0 %}
        <span class="text-success">Stock: {{ stock }}</span>
        {% else %}
        <span class="text-danger">Out of stock</span>
        {% endif %}
      </p>
      <p class="lead">Color: Jet Black</p>
      <p>Train supported. Play protected.</p>
      <p>The ATHLETO ShieldKnee Pro sleeves offer full-length compression and joint protection during high-impact activities. With 4-way stretch and moisture control, they help reduce strain while giving you the confidence to move at full intensity—on the court, the mat, or the track.</p>

      <p>Features:</p>
      <ul>
        <li>Full-length coverage and firm compression</li>
        <li>Breathable, sweat-wicking material</li>
        <li>Non-slip grip lining</li>
        <li>Ideal for training, recovery, or game-day use</li>
      </ul>

      <div class="mb-3">
        <label for="quantity" class="form-label">Quantity:</label>
        <div class="input-group" style="width: 120px;">
          <button type="button" class="btn btn-outline-secondary" onclick="changeQuantity(-1)" id="minusBtn" {% if stock==0 %}disabled{% endif %}>-</button>
          <input type="number" id="quantityInput" value="1" min="1" max="{{ stock if stock > 0 else 1 }}" name="quantity" class="form-control text-center" {% if stock==0 %}disabled{% endif %}>
          <button type="button" class="btn btn-outline-secondary" onclick="changeQuantity(1)" id="plusBtn" {% if stock==0 %}disabled{% endif %}>+</button>
        </div>
        <div id="stockWarning" class="text-danger mt-1" style="display:none;">Not enough stock!</div>
      </div>

      <!-- Add to Cart Form -->
      <form action="{{ url_for('add_to_cart', product_id='accessories4') }}" method="post" style="display:inline;">
        <input type="hidden" name="price" value="695">
        <input type="hidden" name="quantity" id="addToCartQty" value="1">
        <input type="hidden" name="size" value="none">
        <button type="submit" class="btn btn-success" id="addToCartBtn" {% if stock==0 %}disabled{% endif %}>Add to Cart</button>
      </form>

      <!-- Buy Now Form -->
      <form action="{{ url_for('buy_now_info', product_id='accessories4') }}" method="post" style="display:inline;">
        <input type="hidden" name="price" value="695">
        <input type="hidden" name="quantity" id="buyNowQty" value="1">
        <input type="hidden" name="size" value="none">
        <button type="submit" class="btn btn-warning" id="buyNowBtn" {% if stock==0 %}disabled{% endif %}>Buy Now</button>
      </form>

      <div class="mt-3">
        <a href="{{ url_for('accessories') }}" class="btn btn-outline-secondary">Back to ACCESSORIES</a>
      </div>
    </div>
  </div>
</div>

<script type="text/template" id="maxStockData">{{ stock|default(0)|int }}</script>
<script>
  var maxStock = parseInt(document.getElementById("maxStockData").textContent) || 0;
  var quantityInput = document.getElementById("quantityInput");
  var addToCartQtyInput = document.getElementById("addToCartQty");
  var buyNowQtyInput = document.getElementById("buyNowQty");
  var stockWarning = document.getElementById("stockWarning");
  var addToCartBtn = document.getElementById("addToCartBtn");
  var buyNowBtn = document.getElementById("buyNowBtn");
  var minusBtn = document.getElementById("minusBtn");
  var plusBtn = document.getElementById("plusBtn");

  function updateInputs() {
    var qty = parseInt(quantityInput.value) || 1;
    if (qty < 1) qty = 1;
    if (qty > maxStock) qty = maxStock;
    quantityInput.value = qty;
    addToCartQtyInput.value = qty;
    buyNowQtyInput.value = qty;

    if (maxStock === 0) {
      stockWarning.style.display = "block";
      addToCartBtn.disabled = true;
      buyNowBtn.disabled = true;
      quantityInput.disabled = true;
      minusBtn.disabled = true;
      plusBtn.disabled = true;
    } else if (qty > maxStock) {
      stockWarning.style.display = "block";
      addToCartBtn.disabled = true;
      buyNowBtn.disabled = true;
    } else {
      stockWarning.style.display = "none";
      addToCartBtn.disabled = false;
      buyNowBtn.disabled = false;
      quantityInput.disabled = false;
      minusBtn.disabled = (qty <= 1);
      plusBtn.disabled = (qty >= maxStock);
    }
  }

  function changeQuantity(delta) {
    var qty = parseInt(quantityInput.value) || 1;
    qty = qty + delta;
    if (qty < 1) qty = 1;
    if (qty > maxStock) qty = maxStock;
    quantityInput.value = qty;
    updateInputs();
  }

  if (maxStock > 0) {
    quantityInput.addEventListener("input", updateInputs);
    window.addEventListener("load", updateInputs);
  } else {
    // Immediately show warning and keep everything disabled if no stock
    stockWarning.style.display = "block";
    addToCartBtn.disabled = true;
    buyNowBtn.disabled = true;
    quantityInput.disabled = true;
    minusBtn.disabled = true;
    plusBtn.disabled = true;
  }
</script>
{% endblock %}