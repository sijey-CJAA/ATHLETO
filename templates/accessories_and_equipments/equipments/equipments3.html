{% extends "base.html" %}
{% block content %}
<div class="container-fluid p-5 mt-5 mb-3" style="background-color: maroon">
  <h3 class="text-center text-white"><b>ATHLETO GripControl Basketball</b></h3>
  <h5 class="text-center text-white">Premium Performance Wear</h5>
</div>

<div class="container">
  <div class="row">
    <div class="col-md-6">
      <img src="{{ url_for('static', filename='pictures/equipments/equipments3.png') }}" class="img-fluid rounded"
        alt="ATHLETO GripControl Basketball" style="max-height: 500px;">
    </div>
    <div class="col-md-6">
      <h2>ATHLETO GripControl Basketball</h2>
      <h5>All-Court Performance Basketball</h5>
      <p class="lead">₱1,095</p>
      <p>
        {% if stock > 0 %}
        <span class="text-success">Stock: {{ stock }}</span>
        {% else %}
        <span class="text-danger">Out of stock</span>
        {% endif %}
      </p>
      <p class="lead">Color: Standard Orange</p>
      <p>Dominate the court. Own the game.</p>

      <p>The ATHLETO GripControl Basketball is made for fast breaks and precision passes. Its deep channels and textured cover deliver superior grip and handling on both indoor hardwood and outdoor asphalt—built for players who never miss a moment to make a move.</p>

      <p>Features:</p>
      <ul>
        <li>Deep channel design for enhanced control</li>
        <li>Durable all-surface rubber composite</li>
        <li>True bounce and shape retention</li>
        <li>Size 7 (official men’s size)</li>
      </ul>

      <div class="mb-3">
        <label for="quantity" class="form-label">Quantity:</label>
        <div class="input-group" style="width: 120px;">
          <button type="button" class="btn btn-outline-secondary" onclick="changeQuantity(-1)" id="minusBtn" {% if stock==0 %}disabled{% endif %}>-</button>
          <input type="number" id="quantityInput" value="1" min="1" max="{{ stock if stock > 0 else 1 }}" name="quantity" class="form-control text-center" {% if stock==0 %}disabled{% endif %}>
          <button type="button" class="btn btn-outline-secondary" onclick="changeQuantity(1)" id="plusBtn" {% if stock==0 %}disabled{% endif %}>+</button>
        </div>
        <div id="stockWarning" class="text-danger mt-1" style="display:none;">Not enough stock!</div>
      </div>

      <!-- Add to Cart Form -->
      <form action="{{ url_for('add_to_cart', product_id='equipments3') }}" method="post" style="display:inline;">
        <input type="hidden" name="price" value="1095">
        <input type="hidden" name="quantity" id="addToCartQty" value="1">
        <input type="hidden" name="size" value="none">
        <button type="submit" class="btn btn-success" id="addToCartBtn" {% if stock==0 %}disabled{% endif %}>Add to Cart</button>
      </form>

      <!-- Buy Now Form -->
      <form action="{{ url_for('buy_now_info', product_id='equipments3') }}" method="post" style="display:inline;">
        <input type="hidden" name="price" value="1095">
        <input type="hidden" name="quantity" id="buyNowQty" value="1">
        <input type="hidden" name="size" value="none">
        <button type="submit" class="btn btn-warning" id="buyNowBtn" {% if stock==0 %}disabled{% endif %}>Buy Now</button>
      </form>
      <!-- Back to equipment Button -->

      <div class="mt-3">
        <a href="{{ url_for('equipments') }}" class="btn btn-outline-secondary">Back to equipment</a>
      </div>
    </div>
  </div>
</div>

<script type="text/template" id="maxStockData">{{ stock|default(0)|int }}</script>
<script>
  var maxStock = parseInt(document.getElementById("maxStockData").textContent) || 0;
  var quantityInput = document.getElementById("quantityInput");
  var addToCartQtyInput = document.getElementById("addToCartQty");
  var buyNowQtyInput = document.getElementById("buyNowQty");
  var stockWarning = document.getElementById("stockWarning");
  var addToCartBtn = document.getElementById("addToCartBtn");
  var buyNowBtn = document.getElementById("buyNowBtn");
  var minusBtn = document.getElementById("minusBtn");
  var plusBtn = document.getElementById("plusBtn");

  function updateInputs() {
    var qty = parseInt(quantityInput.value) || 1;
    if (qty < 1) qty = 1;
    if (qty > maxStock) qty = maxStock;
    quantityInput.value = qty;
    addToCartQtyInput.value = qty;
    buyNowQtyInput.value = qty;

    if (maxStock === 0) {
      stockWarning.style.display = "block";
      addToCartBtn.disabled = true;
      buyNowBtn.disabled = true;
      quantityInput.disabled = true;
      minusBtn.disabled = true;
      plusBtn.disabled = true;
    } else if (qty > maxStock) {
      stockWarning.style.display = "block";
      addToCartBtn.disabled = true;
      buyNowBtn.disabled = true;
    } else {
      stockWarning.style.display = "none";
      addToCartBtn.disabled = false;
      buyNowBtn.disabled = false;
      quantityInput.disabled = false;
      minusBtn.disabled = (qty <= 1);
      plusBtn.disabled = (qty >= maxStock);
    }
  }

  function changeQuantity(delta) {
    var qty = parseInt(quantityInput.value) || 1;
    qty = qty + delta;
    if (qty < 1) qty = 1;
    if (qty > maxStock) qty = maxStock;
    quantityInput.value = qty;
    updateInputs();
  }

  if (maxStock > 0) {
    quantityInput.addEventListener("input", updateInputs);
    window.addEventListener("load", updateInputs);
  } else {
    // Immediately show warning and keep everything disabled if no stock
    stockWarning.style.display = "block";
    addToCartBtn.disabled = true;
    buyNowBtn.disabled = true;
    quantityInput.disabled = true;
    minusBtn.disabled = true;
    plusBtn.disabled = true;
  }
</script>
{% endblock %}