{% extends "base.html" %}
{% block content %}
<div class="container-fluid p-5 mt-5 mb-3" style="background-color: maroon">
  <h3 class="text-center text-white"><b>Quantum Stratus Carbon Flash</b></h3>
  <h5 class="text-center text-white">Premium Performance Wear</h5>
</div>

<div class="container">
  <div class="row">
    <div class="col-md-6">
      <img src="{{ url_for('static', filename='pictures/shoes/shoes8.png') }}" class="img-fluid rounded"
        alt="Quantum Stratus Carbon Flash" style="max-height: 500px;">
    </div>
    <div class="col-md-6">
      <h2>Quantum Stratus Carbon Flash</h2>
      <p class="lead" style="font-size:50px;"> â‚±2,595</p>
      <!-- STOCK DISPLAY -->
      <p>
        <span id="stockDisplay" class="text-success">
          Stock: 0
        </span>
      </p>
      <p class="lead"> Color: Carbon Black & Red</p>

      <p>Experience next-level propulsion. The Quantum Stratus Carbon Flash features a carbon-infused sole for unmatched energy return and a futuristic look. Designed for runners seeking speed and efficiency on every run.</p>

      <p> Features:</p>
      <p>Carbon plate for propulsion</p>
      <p>Lightweight mesh upper</p>
      <p>Responsive foam cushioning</p>
      <p>Reflective accents for visibility</p>

      <!-- Shoe Size Dropdown -->
      <div class="mb-3">
        <label class="form-label">Select Size:</label>
        <select class="form-select" style="width: 220px;" id="sizeSelect">
          {% for size in size_stock.keys() %}
          <option value="{{ size }}" {% if loop.first %}selected{% endif %}>
            {{ size }}
          </option>
          {% endfor %}
        </select>
        <div class="form-text text-muted">Sizes: Men's US 4 - 10 / Women's US 5.5 - 11.5</div>
      </div>

      <div class="mb-3">
        <label for="quantity" class="form-label">Quantity:</label>
        <div class="input-group" style="width: 120px;">
          <button type="button" class="btn btn-outline-secondary" onclick="changeQuantity(-1)">-</button>
          <input type="number" id="quantityInput" value="1" min="1" name="quantity" class="form-control text-center">
          <button type="button" class="btn btn-outline-secondary" onclick="changeQuantity(1)">+</button>
        </div>
        <small id="quantityError" class="text-danger" style="display:none;">Cannot exceed available stock.</small>
      </div>

      <!-- Add to Cart and Buy Now Buttons -->
      <div class="mb-2">
        <form id="addToCartForm" action="{{ url_for('add_to_cart', product_id='shoes8') }}" method="post"
          style="display:inline;">
          <input type="hidden" name="size" id="addToCartSize" value="">
          <input type="hidden" name="quantity" id="addToCartQty" value="1">
          <button type="submit" class="btn btn-success" id="addToCartBtn">
            Add to Cart
          </button>
        </form>

        <form id="buyNowForm" action="{{ url_for('buy_now_info', product_id='shoes8') }}" method="post"
          style="display:inline;">
          <input type="hidden" name="size" id="buyNowSize" value="">
          <input type="hidden" name="price" value="2595">
          <input type="hidden" name="quantity" id="buyNowQty" value="1">
          <button type="submit" class="btn btn-warning" id="buyNowBtn">
            Buy Now
          </button>
        </form>
      </div>
      <div class="mt-3">
        <a href="{{ url_for('shoes') }}" class="btn btn-outline-secondary">Back to Shoes</a>
      </div>
    </div>
  </div>
</div>

<!-- Inject stock per size -->
<script id="size-stock-data" type="application/json">
  {{ size_stock | tojson }}
</script>

<script>
  const sizeStock = JSON.parse(document.getElementById("size-stock-data").textContent);

  const sizeSelect = document.getElementById("sizeSelect");
  const addToCartSizeInput = document.getElementById("addToCartSize");
  const buyNowSizeInput = document.getElementById("buyNowSize");

  const quantityInput = document.getElementById("quantityInput");
  const addToCartQtyInput = document.getElementById("addToCartQty");
  const buyNowQtyInput = document.getElementById("buyNowQty");
  const quantityError = document.getElementById("quantityError");
  const stockDisplay = document.getElementById("stockDisplay");

  let maxStock = 1;

  function updateInputs() {
    const selectedSize = sizeSelect.value;
    const stock = Number(sizeStock[selectedSize]) || 0;

    stockDisplay.textContent = "Stock: " + stock;
    quantityInput.max = stock;
    maxStock = stock;

    let selectedQty = parseInt(quantityInput.value, 10);
    if (isNaN(selectedQty) || selectedQty < 1) selectedQty = 1;

    if (selectedQty > stock) {
      selectedQty = stock > 0 ? stock : 1;
      quantityInput.value = selectedQty;
      quantityError.style.display = "inline";
    } else {
      quantityError.style.display = "none";
    }

    addToCartSizeInput.value = selectedSize;
    buyNowSizeInput.value = selectedSize;
    addToCartQtyInput.value = selectedQty;
    buyNowQtyInput.value = selectedQty;

    document.getElementById("addToCartBtn").disabled = stock === 0;
    document.getElementById("buyNowBtn").disabled = stock === 0;
    quantityInput.disabled = stock === 0;
  }

  function changeQuantity(delta) {
    let qty = parseInt(quantityInput.value, 10) || 1;
    qty = Math.max(1, Math.min(maxStock, qty + delta));
    quantityInput.value = qty;
    updateInputs();
  }

  sizeSelect.addEventListener("change", updateInputs);
  quantityInput.addEventListener("input", updateInputs);
  window.addEventListener("DOMContentLoaded", updateInputs);
</script>
{% endblock %}