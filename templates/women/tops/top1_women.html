{% extends "base.html" %}
{% block content %}
<div class="container-fluid p-5 mt-5 mb-3" style="background-color: maroon">
  <h3 class="text-center text-white"><b>ATHLETO AeroCrop Dri-Fit Tee</b></h3>
  <h5 class="text-center text-white">Premium Performance Wear</h5>
</div>

<div class="container">
  <div class="row">
    <div class="col-md-6">
      <img src="{{ url_for('static', filename='pictures/women/top1_women.png') }}" class="img-fluid rounded"
        alt="Athletic Tee" style="max-height: 500px;">
    </div>
    <div class="col-md-6">
      <h2>ATHLETO AeroCrop Dri-Fit Tee</h2>
      <h5><i>Women’s Performance Crop Top</i></h5>
      <p class="lead"> ₱1,095</p>

      <p>
        <span id="stockDisplay" class="text-success">
          Stock: {{ size_stock.get('M', 0) }}
        </span>
      </p>

      <p class="lead"> Color: Midnight Black</p>
      <p>Light. Strong. Ready to move.</p>

      <p>The ATHLETO AeroCrop Dri-Fit Tee blends breathable performance with a sleek cropped fit, 
      built for women who move with purpose. Engineered with sweat-wicking Dri-Fit fabric and a 
      contour-hugging cut, it keeps you dry, focused, and confidently styled during workouts or everyday 
      training.</p>

      <p> Features:</p>
      <p>Dri-Fit moisture-wicking technology</p>
      <p>Cropped silhouette for a modern look</p>
      <p>Lightweight and breathable material</p>
      <p>Designed for studio, gym, or street</p>

      <div class="mb-3">
        <label class="form-label">Size:</label>
        <select class="form-select" style="width: 100px;" id="sizeSelect">
          {% for size in ['XS', 'S', 'M', 'L', 'XL'] %}
          <option value="{{ size }}" {% if size == 'M' %}selected{% endif %}>{{ size }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="mb-3">
        <label for="quantity" class="form-label">Quantity:</label>
        <div class="input-group" style="width: 120px;">
          <button type="button" class="btn btn-outline-secondary" onclick="changeQuantity(-1)">-</button>
          <input 
            type="number" 
            id="quantityInput" 
            value="1" 
            min="1" 
            name="quantity" 
            class="form-control text-center"
          >
          <button type="button" class="btn btn-outline-secondary" onclick="changeQuantity(1)">+</button>
        </div>
        <small id="quantityError" class="text-danger" style="display:none;">Cannot exceed available stock.</small>
      </div>

      <!-- Add to Cart and Buy Now Buttons -->
      <div class="mb-2">
        <form id="addToCartForm" action="{{ url_for('add_to_cart', product_id='top1_women') }}" method="post" style="display:inline;">
          <input type="hidden" name="size" id="addToCartSize" value="M">
          <input type="hidden" name="quantity" id="addToCartQty" value="1">
          <button type="submit" class="btn btn-success" id="addToCartBtn">
            Add to Cart
          </button>
        </form>

        <form id="buyNowForm" action="{{ url_for('buy_now_info', product_id='top1_women') }}" method="post" style="display:inline;">
          <input type="hidden" name="size" id="buyNowSize" value="M">
          <input type="hidden" name="price" value="1095.00">
          <input type="hidden" name="quantity" id="buyNowQty" value="1">
          <button type="submit" class="btn btn-warning" id="buyNowBtn">
            Buy Now
          </button>
        </form>
      </div>

      <div class="mt-3">
        <a href="{{ url_for('top_women') }}" class="btn btn-outline-secondary">Back to Tops</a>
      </div>
    </div>
  </div>
</div>

<!-- Inject stock per size -->
<!-- Inject stock data safely -->
<script id="size-stock-data" type="application/json">
  {{ size_stock | tojson }}
</script>

<script>
  const sizeStock = JSON.parse(document.getElementById("size-stock-data").textContent);

  const sizeSelect = document.getElementById("sizeSelect");
  const addToCartSizeInput = document.getElementById("addToCartSize");
  const buyNowSizeInput = document.getElementById("buyNowSize");

  const quantityInput = document.getElementById("quantityInput");
  const addToCartQtyInput = document.getElementById("addToCartQty");
  const buyNowQtyInput = document.getElementById("buyNowQty");
  const quantityError = document.getElementById("quantityError");
  const stockDisplay = document.getElementById("stockDisplay");

  let maxStock = 1;

  function updateInputs() {
    const selectedSize = sizeSelect.value;
    const stock = sizeStock[selectedSize] || 0;

    stockDisplay.textContent = "Stock: " + stock;

    quantityInput.max = stock;
    maxStock = stock;

    let selectedQty = parseInt(quantityInput.value);

    if (selectedQty > stock) {
      selectedQty = stock;
      quantityInput.value = selectedQty;
      quantityError.style.display = "inline";
    } else {
      quantityError.style.display = "none";
    }

    if (selectedQty < 1 || isNaN(selectedQty)) {
      selectedQty = 1;
      quantityInput.value = selectedQty;
    }

    addToCartSizeInput.value = selectedSize;
    buyNowSizeInput.value = selectedSize;
    addToCartQtyInput.value = selectedQty;
    buyNowQtyInput.value = selectedQty;

    document.getElementById("addToCartBtn").disabled = stock === 0;
    document.getElementById("buyNowBtn").disabled = stock === 0;
  }

  function changeQuantity(delta) {
    let qty = parseInt(quantityInput.value) || 1;
    qty = Math.max(1, Math.min(maxStock, qty + delta));
    quantityInput.value = qty;
    updateInputs();
  }

  sizeSelect.addEventListener("change", updateInputs);
  quantityInput.addEventListener("input", updateInputs);
  window.addEventListener("load", updateInputs);
</script>

{% endblock %}
